<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Reproductor con Fullscreen Funcional</title>
    <script src="./assets/js/subtitles-octopus.js"></script>
    <style>
        /* Usamos los estilos "Crunchyroll" de la versión anterior que te gustaron */
        body { background-color: #1a1a1a; }
        #video-container { position: relative; width: 800px; margin: 50px auto; background-color: black; font-family: Arial, sans-serif; }
        #video { width: 100%; display: block; }
        #custom-controls { position: absolute; bottom: 0; left: 0; width: 100%; padding: 8px 12px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); display: flex; align-items: center; gap: 15px; color: white; box-sizing: border-box; opacity: 0; transition: opacity 0.3s ease-in-out; }
        #video-container:hover #custom-controls, #video-container.paused #custom-controls { opacity: 1; }
        #progress-bar { flex-grow: 1; height: 5px; background-color: rgba(255, 255, 255, 0.4); cursor: pointer; border-radius: 5px; }
        #progress-filled { height: 100%; width: 0; background-color: #9f50ff; border-radius: 5px; }
        #time-display { font-size: 14px; font-weight: bold; text-shadow: 1px 1px 2px black; }
        .control-button { background: transparent; border: none; color: white; font-size: 16px; font-weight: bold; padding: 5px; cursor: pointer; text-shadow: 1px 1px 2px black; }
    </style>
</head>
<body>

    <div id="video-container">
        <video id="video" autoplay></video> 
        
        <div id="custom-controls">
            <div id="time-display"><span id="time-current">00:00</span> / <span id="time-duration">00:00</span></div>
            <div id="progress-bar"><div id="progress-filled"></div></div>
            <button id="custom-cc-button" class="control-button">CC</button>
            <button id="custom-fullscreen-button" class="control-button">⛶</button>
        </div>
    </div>

    <script>
        // --- REFERENCIAS (Todas las que necesitamos) ---
        const videoContainer = document.getElementById('video-container');
        const videoElement = document.getElementById('video');
        const ccButton = document.getElementById('custom-cc-button');
        const fullscreenButton = document.getElementById('custom-fullscreen-button');
        const progressBar = document.getElementById('progress-bar');
        const progressFilled = document.getElementById('progress-filled');
        const timeCurrent = document.getElementById('time-current');
        const timeDuration = document.getElementById('time-duration');
        
        videoElement.src = 'https://ia601707.us.archive.org/34/items/sukebe-elf-tanbouki-1/Sukebe%20Elf%20Tanbouki%20-%201.mkv';

        // --- LÓGICA PLAY/PAUSA ---
        videoElement.addEventListener('click', () => videoElement.paused ? videoElement.play() : videoElement.pause());
        videoElement.addEventListener('play', () => videoContainer.classList.remove('paused'));
        videoElement.addEventListener('pause', () => videoContainer.classList.add('paused'));

        // ===============================================================
        //           LÓGICA DEL BOTÓN CC (COMPLETA Y RESTAURADA)
        // ===============================================================
        let octopusInstance = null;
        ccButton.addEventListener('click', function() {
            if (octopusInstance) {
                octopusInstance.dispose();
                octopusInstance = null;
                ccButton.style.color = 'white';
            } else {
                const options = { video: videoElement, subUrl: '/visor-imgen/subtitles/Sukebe Elf Tanbouki - 1.es.ass', fonts: ['/visor-imgen/fonts/Lato-Italic.ttf'], workerUrl: '/visor-imgen/assets/js/subtitles-octopus-worker.js' };
                octopusInstance = new SubtitlesOctopus(options);
                ccButton.style.color = '#9f50ff';
            }
        });

        // ===============================================================
        //          LÓGICA DEL BOTÓN FULLSCREEN (COMPLETA Y RESTAURADA)
        // ===============================================================
        fullscreenButton.addEventListener('click', function() {
            if (!document.fullscreenElement) {
                videoContainer.requestFullscreen().catch(err => alert(`Error: ${err.message}`));
            } else {
                document.exitFullscreen();
            }
        });
        document.addEventListener('fullscreenchange', () => {
            if (octopusInstance) {
                setTimeout(() => octopusInstance.resize(), 150); // Ligero aumento del delay por si acaso
            }
        });

        // --- LÓGICA LÍNEA DE CARGA Y TIEMPOS (Sin cambios, ya era correcta) ---
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
        videoElement.addEventListener('loadedmetadata', () => timeDuration.textContent = formatTime(videoElement.duration));
        videoElement.addEventListener('timeupdate', () => {
            progressFilled.style.width = `${(videoElement.currentTime / videoElement.duration) * 100}%`;
            timeCurrent.textContent = formatTime(videoElement.currentTime);
        });
        progressBar.addEventListener('click', (e) => {
            videoElement.currentTime = (e.offsetX / progressBar.offsetWidth) * videoElement.duration;
        });
    </script>
</body>
</html>
